import { groupBy } from "./utils/helper";

describe("Test Happy path of midpoint generation", () => {
  const testCsvArray = [
    {
      POSTCODE: "AL1  1AG",
      POSTCODE_2: "AL1 1AG",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      EASTING_1M: "515487",
      NORTHING_1M: "0206498",
      LSOA_2011: "E01023741",
      MSOA_2011: "E02004940",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120543",
      LSOA_2021: "E01023741",
      MSOA_2021: "E02004940",
      IMD_RANK: "30070",
      IMD_DECILE: "10",
      LSOA_NAME: "St Albans 017E",
    },
    {
      POSTCODE: "AL1  1AJ",
      POSTCODE_2: "AL1 1AJ",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      EASTING_1M: "515491",
      NORTHING_1M: "0206410",
      LSOA_2011: "E01023741",
      MSOA_2011: "E02004940",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120543",
      LSOA_2021: "E01023741",
      MSOA_2021: "E02004940",
      IMD_RANK: "30070",
      IMD_DECILE: "10",
      LSOA_NAME: "St Albans 017E",
    },
    {
      POSTCODE: "AL1  1AR",
      POSTCODE_2: "AL1 1AR",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      EASTING_1M: "516270",
      NORTHING_1M: "0205897",
      LSOA_2011: "E01023684",
      MSOA_2011: "E02004939",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120276",
      LSOA_2021: "E01023684",
      MSOA_2021: "E02004939",
      IMD_RANK: "28935",
      IMD_DECILE: "9",
      LSOA_NAME: "St Albans 016D",
    },
    {
      POSTCODE: "AL1  1AS",
      POSTCODE_2: "AL1 1AS",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      EASTING_1M: "515005",
      NORTHING_1M: "0206908",
      LSOA_2011: "E01023726",
      MSOA_2011: "E02004935",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120492",
      LSOA_2021: "E01023726",
      MSOA_2021: "E02004935",
      IMD_RANK: "29172",
      IMD_DECILE: "9",
      LSOA_NAME: "St Albans 012A",
    },
    {
      POSTCODE: "AL1  1AT",
      POSTCODE_2: "AL1 1AT",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      EASTING_1M: "516131",
      NORTHING_1M: "0206148",
      LSOA_2011: "E01023682",
      MSOA_2011: "E02004939",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120267",
      LSOA_2021: "E01023682",
      MSOA_2021: "E02004939",
      IMD_RANK: "20975",
      IMD_DECILE: "7",
      LSOA_NAME: "St Albans 016B",
    },
  ];

  test("test GroupBy function", async () => {
    const result = groupBy(testCsvArray, "LSOA_2011");
    expect(result).toStrictEqual([
      {
        POSTCODE: "AL1  1AG",
        POSTCODE_2: "AL1 1AG",
        LOCAL_AUT_ORG: "606",
        NHS_ENG_REGION: "Y61",
        SUB_ICB: "",
        CANCER_REGISTRY: "Y0401",
        EASTING_1M: "515487",
        NORTHING_1M: "0206498",
        LSOA_2011: "E01023741",
        MSOA_2011: "E02004940",
        CANCER_ALLIANCE: "E56000023",
        ICB: "QM7",
        OA_2021: "E00120543",
        LSOA_2021: "E01023741",
        MSOA_2021: "E02004940",
        IMD_RANK: "30070",
        IMD_DECILE: "10",
        LSOA_NAME: "St Albans 017E",
        AVG_EASTING: "515488",
        AVG_NORTHING: "0206454",
      },
      {
        POSTCODE: "AL1  1AJ",
        POSTCODE_2: "AL1 1AJ",
        LOCAL_AUT_ORG: "606",
        NHS_ENG_REGION: "Y61",
        SUB_ICB: "",
        CANCER_REGISTRY: "Y0401",
        EASTING_1M: "515491",
        NORTHING_1M: "0206410",
        LSOA_2011: "E01023741",
        MSOA_2011: "E02004940",
        CANCER_ALLIANCE: "E56000023",
        ICB: "QM7",
        OA_2021: "E00120543",
        LSOA_2021: "E01023741",
        MSOA_2021: "E02004940",
        IMD_RANK: "30070",
        IMD_DECILE: "10",
        LSOA_NAME: "St Albans 017E",
        AVG_EASTING: "515488",
        AVG_NORTHING: "0206454",
      },
      {
        POSTCODE: "AL1  1AR",
        POSTCODE_2: "AL1 1AR",
        LOCAL_AUT_ORG: "606",
        NHS_ENG_REGION: "Y61",
        SUB_ICB: "",
        CANCER_REGISTRY: "Y0401",
        EASTING_1M: "516270",
        NORTHING_1M: "0205897",
        LSOA_2011: "E01023684",
        MSOA_2011: "E02004939",
        CANCER_ALLIANCE: "E56000023",
        ICB: "QM7",
        OA_2021: "E00120276",
        LSOA_2021: "E01023684",
        MSOA_2021: "E02004939",
        IMD_RANK: "28935",
        IMD_DECILE: "9",
        LSOA_NAME: "St Albans 016D",
        AVG_EASTING: "516270",
        AVG_NORTHING: "0205897",
      },
      {
        POSTCODE: "AL1  1AS",
        POSTCODE_2: "AL1 1AS",
        LOCAL_AUT_ORG: "606",
        NHS_ENG_REGION: "Y61",
        SUB_ICB: "",
        CANCER_REGISTRY: "Y0401",
        EASTING_1M: "515005",
        NORTHING_1M: "0206908",
        LSOA_2011: "E01023726",
        MSOA_2011: "E02004935",
        CANCER_ALLIANCE: "E56000023",
        ICB: "QM7",
        OA_2021: "E00120492",
        LSOA_2021: "E01023726",
        MSOA_2021: "E02004935",
        IMD_RANK: "29172",
        IMD_DECILE: "9",
        LSOA_NAME: "St Albans 012A",
        AVG_EASTING: "515005",
        AVG_NORTHING: "0206908",
      },
      {
        POSTCODE: "AL1  1AT",
        POSTCODE_2: "AL1 1AT",
        LOCAL_AUT_ORG: "606",
        NHS_ENG_REGION: "Y61",
        SUB_ICB: "",
        CANCER_REGISTRY: "Y0401",
        EASTING_1M: "516131",
        NORTHING_1M: "0206148",
        LSOA_2011: "E01023682",
        MSOA_2011: "E02004939",
        CANCER_ALLIANCE: "E56000023",
        ICB: "QM7",
        OA_2021: "E00120267",
        LSOA_2021: "E01023682",
        MSOA_2021: "E02004939",
        IMD_RANK: "20975",
        IMD_DECILE: "7",
        LSOA_NAME: "St Albans 016B",
        AVG_EASTING: "516131",
        AVG_NORTHING: "0206148",
      },
    ]);
  });
});

describe("Test fail path of midpoint generation", () => {
  const failArray = [
    {
      POSTCODE: "AL1  1AG",
      POSTCODE_2: "AL1 1AG",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      LSOA_2011: "E01023741",
      MSOA_2011: "E02004940",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120543",
      LSOA_2021: "E01023741",
      MSOA_2021: "E02004940",
      IMD_RANK: "30070",
      IMD_DECILE: "10",
      LSOA_NAME: "St Albans 017E",
    },
    {
      POSTCODE: "AL1  1AJ",
      POSTCODE_2: "AL1 1AJ",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      LSOA_2011: "E01023741",
      MSOA_2011: "E02004940",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120543",
      LSOA_2021: "E01023741",
      MSOA_2021: "E02004940",
      IMD_RANK: "30070",
      IMD_DECILE: "10",
      LSOA_NAME: "St Albans 017E",
    },
    {
      POSTCODE: "AL1  1AR",
      POSTCODE_2: "AL1 1AR",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      LSOA_2011: "E01023684",
      MSOA_2011: "E02004939",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120276",
      LSOA_2021: "E01023684",
      MSOA_2021: "E02004939",
      IMD_RANK: "28935",
      IMD_DECILE: "9",
      LSOA_NAME: "St Albans 016D",
    },
    {
      POSTCODE: "AL1  1AS",
      POSTCODE_2: "AL1 1AS",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      LSOA_2011: "E01023726",
      MSOA_2011: "E02004935",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120492",
      LSOA_2021: "E01023726",
      MSOA_2021: "E02004935",
      IMD_RANK: "29172",
      IMD_DECILE: "9",
      LSOA_NAME: "St Albans 012A",
    },
    {
      POSTCODE: "AL1  1AT",
      POSTCODE_2: "AL1 1AT",
      LOCAL_AUT_ORG: "606",
      NHS_ENG_REGION: "Y61",
      SUB_ICB: "",
      CANCER_REGISTRY: "Y0401",
      LSOA_2011: "E01023682",
      MSOA_2011: "E02004939",
      CANCER_ALLIANCE: "E56000023",
      ICB: "QM7",
      OA_2021: "E00120267",
      LSOA_2021: "E01023682",
      MSOA_2021: "E02004939",
      IMD_RANK: "20975",
      IMD_DECILE: "7",
      LSOA_NAME: "St Albans 016B",
    },
  ];

  test("test GroupBy function", () => {
    expect(() => {
      groupBy(failArray, "LSOA_2011");
    }).toThrow("groupBy function failed: ");
  });
});
